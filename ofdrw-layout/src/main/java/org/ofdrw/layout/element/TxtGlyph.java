package org.ofdrw.layout.element;

/**
 * 文字字符块
 *
 * @author 权观宇
 * @since 2020-02-28 05:51:05
 */
public class TxtGlyph {
    /**
     * 可打印的ASCII表字母宽度所占用百分比
     * <p>
     * ASCII区间: [32,126]
     * <p>
     * 其中空格特殊处理，默认为半个字符宽度也就是 0.5
     */
    public static final double[] PRINTABLE_ASCII_WIDTH_MAP = {
            0.5, 0.3125, 0.435546875, 0.63818359375, 0.58642578125, 0.8896484375, 0.8701171875, 0.25634765625, 0.333984375, 0.333984375, 0.455078125, 0.74169921875, 0.24072265625, 0.4326171875, 0.24072265625, 0.42724609375, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.58642578125, 0.24072265625, 0.24072265625, 0.74169921875, 0.74169921875, 0.74169921875, 0.48291015625, 1.03125, 0.70361328125, 0.62744140625, 0.6689453125, 0.76171875, 0.5498046875, 0.53125, 0.74365234375, 0.7734375, 0.2939453125, 0.39599609375, 0.634765625, 0.51318359375, 0.97705078125, 0.81298828125, 0.81494140625, 0.61181640625, 0.81494140625, 0.65283203125, 0.5771484375, 0.5732421875, 0.74658203125, 0.67626953125, 1.017578125, 0.64501953125, 0.603515625, 0.6201171875, 0.333984375, 0.416015625, 0.333984375, 0.74169921875, 0.4482421875, 0.294921875, 0.552734375, 0.638671875, 0.50146484375, 0.6396484375, 0.5673828125, 0.3466796875, 0.6396484375, 0.61572265625, 0.26611328125, 0.26708984375, 0.54443359375, 0.26611328125, 0.93701171875, 0.6162109375, 0.6357421875, 0.638671875, 0.6396484375, 0.3818359375, 0.462890625, 0.37255859375, 0.6162109375, 0.52490234375, 0.78955078125, 0.5068359375, 0.529296875, 0.49169921875, 0.333984375, 0.26904296875, 0.333984375, 0.74169921875
    };

    /**
     * 文字
     */
    private char txt;
    /**
     * 父类元素
     */
    private Span parent;

    public TxtGlyph(char txt, Span span) {
        this.txt = txt;
        this.parent = span;
    }

    /**
     * @return 字符宽度(字符宽度 + 字间距)
     */
    public double getW() {
        double w = parent.getLetterSpacing();
        // 所有 ASCII码均采用半角
        if (txt >= 32 && txt <= 126) {
            // 根据可打印宽度比例映射表打印
            w += parent.getFontSize() * (PRINTABLE_ASCII_WIDTH_MAP[txt - 32]);
        } else {
            // 非英文字符
            w += parent.getFontSize();
        }
        return w;
    }

    /**
     * @return 字符高度
     */
    public double getH() {
        return parent.getFontSize();
    }

}
